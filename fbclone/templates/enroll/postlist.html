<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
 <link rel="stylesheet" type='text/css' href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.14/semantic.min.css">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
 <link rel="stylesheet" href="{% static 'enroll/css/bootstrap.css' %}">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
 <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js'></script>
 <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.js'></script>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

 
 <style>
     .postcenter{
          text-align: center;
     }
     img{
       text-align: center;
       margin-left: 30%;
     }
    #example2 {
      border: 1px solid;
      padding: 10px;
      box-shadow: 5px 10px 18px #888888;
    }
    #comm{
        text-align: center;
        color: blue;
    }
    #comment{
        margin-left: 10%;
    }

</style>
</head>
<body>
 <div class="container mt-5">
    <div class="text-center alert alert-danger">
      <h1 style="float:left;">Home Page  </h1>
      
      {% if user.is_authenticated %}
          <h4 style="color: black; float:right;">Welcome {{user}}</h4>
          <a class="btn btn-primary" href="{% url 'mypost' %}" role="button">My Post</a>
          <a class="btn btn-primary" href="{% url 'post'%}" role="button">Create Post</a>
          <a class="btn btn-primary" href="{% url 'logout' %}" role="button">Logout</a>
          <hr style="clear:both;"/>
      {% else %}
          <a class="btn btn-primary" href="{% url 'login' %}" role="button">Login</a>
          <a class="btn btn-primary" href="{% url 'register' %}" role="button">Registration</a>
          <hr style="clear:both;"/>
      {% endif %}
    </div>
    
    {% for i in post_list %}
     <h1 class="postcenter">{{i.title}}</h1>
     <a href="{% url 'mypostdeatils' i.id %}"><img src="{{ i.image.url }}" width="400" height="200"></a>
     
     <h5>Author Name :-{{i.author}}</h5>
     <p>Description :- {{i.description}}</p>  
     <p>{{i.created_at}}</p>
       <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal{{i.id}}">
    Comments
    </button>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal{{i.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel{{i.id}}">Comments</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="{% url 'mment'%}" method="POST" class="comment-from" id="{{i.id}}">
                {% csrf_token %}
                <input type="hidden" name="postSno" value="{{i.id}}" id="name"><br>
                Content: <br/>
                <textarea name="comment" id="content" cols="35" rows="8"></textarea>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary"  class="comment-btn">submit</button>
                </div>
        </form>
      </div>
    </div>
    </div>
    </div><br><br>

    <div id="main">
        <h3 id="comm">Comments</h3>
        {% if not i.comments.all %}
            <p> No Comments</p>
        {% else %}
            {% for comment in i.comments.all %}
            <div id="maincomm">
                <span><strong>User:-{{comment.user}}</strong></span>
                <p id="cb">{{comment.body}}</p>
                <span><strong>Created time :-{{comment.created}}</strong></span>
            </div>
            <hr>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    <br><br>
    <div class="col-sm-1">           
    <form method="POST" action="/like/" id="{{i.id}}" class="like-from">
      {% csrf_token %}
      <input type="hidden" id="fname" name="post_id" value="{{i.id}}">
    
      <button class="btn btn-outline-success" id="like-btn{{i.id}}" type="submit">
      {% if user not in i.likes.all %}
      Like
      {% else %}
      Unlike
      {% endif %}
      </button>
    
      <h5 id="like-count{{i.id}}">{{i.likeusers}}</h5>
    </form><br>
    </div>
    <div>
     {% if user == i.author %}
      <a class="btn btn-outline-success" href="{% url 'deleteview' i.id %}">Delete</a>
      <a class="btn btn-outline-success" href="{% url 'updateview' i.id %}">Edit</a>
     {% endif %}
     <hr>
    {% endfor %}   
 </div>
 <script src="{% static 'enroll/js/jquery.js' %}"></script>
 <script src="{% static 'enroll/js/jquery.min.js' %}"></script>
 <script src="{% static 'enroll/js/popper.js' %}"></script>
 <script src="{% static 'enroll/js/bootstrap.js' %}"></script>
 <script>
    $(document).ready(function(){
        $('.like-from').click(function(event){
            event.preventDefault()
            let total ;
            const post_id = $(this).attr('id')
            const likeText = $(`#like-btn${post_id}`).text()
            const likecount = $(`#like-count${post_id}`).text()
            const likeuser = $(`#like-user${post_id}`).text()
            const trims = $.trim(likeuser)
            const trim = $.trim(likeText)
            const trimCount = parseInt(likecount)
            
            $.ajax({

                method :'POST',
                url: '{% url "like-post" %}',
                data: {
                        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                        'post_id':post_id,
                },
                success: function(response){
                    if (trim === "Unlike"){
                        $(`#like-btn${post_id}`).text('Like') 
                        total=trimCount-1 

                    }else{
                        $(`#like-btn${post_id}`).text('Unlike')  
                        total=trimCount+1  
                    }
                    $(`#like-count${post_id}`).text(total)
                                      
                },
                error : function(response){
                    console.log('error',response)
                }
            }) 
        });// End Ajax
        $('.comment-btn').click(function(event){
            event.preventDefault();
            const post_id = $(this).attr('id');
            const constname=$('#name').val();
            const constbody=$('#content').val();
            console.log(constbody)
            $.ajax({
                method: 'POST',
                url:'{% url 'mment' %}', 
                data: {
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                    'post_id':post_id,
                    'post':constname,
                    'body':constbody,
                },
                success: function (data) {
                    $('#maincomm').append(`<p>`+$data['body']+`</p>`);
                },
                error : function(response){
                    console.log('poonam',response)
                }
            
            })
        });// End Onclick   
    }); // End Documents       
</script>
<script></script>
</body>
</html>
